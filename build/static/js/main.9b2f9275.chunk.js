(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{269:function(e,t,n){e.exports=n(270)},270:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n.n(r),o=n(7),c=n(12),i=n(41),u=n(14),s=n(19),f=n(15),l=n(13),d=n(62),h=n.n(d),v=n(227),m=n.n(v),p=n(226),b=n(225),x=n.n(b);n(295),n(296);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}p.d("webgl");var g=.4,w=0,R=7;function F(){return(F=Object(l.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.c("https://raw.githubusercontent.com/wohlig/TFJS-object-detection/master/models/diamond_detector_320_2000/model.json");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var j=function(e){Object(u.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).videoRef=h.a.createRef(),r.canvasRef=h.a.createRef(),r.detectFrame=function(e,t){p.b().startScope(),t.executeAsync(r.process_input(e)).then(function(n){var a=n[w].dataSync();a=x.a.map(a,function(e){return e}),a=x.a.chunk(a,4);var o=n[R].dataSync(),c=x.a.map(o,function(e,t){return{score:e,box:a[t]}});c=x.a.filter(c,function(e){return e.score>=g}),console.log(c),r.setState({count:c.length}),r.renderPredictions(c,e),requestAnimationFrame(function(){Object(i.a)(r).detectFrame(e,t)}),p.b().endScope()})},r.renderPredictions=function(e){var t=r.canvasRef.current.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);var n="16px sans-serif";t.font=n,t.textBaseline="top";var a=r.buildDetectedObjects(e);a.forEach(function(e){var r=e.bbox[0],a=e.bbox[1],o=e.bbox[2],c=e.bbox[3];t.strokeStyle="#00FFFF",t.lineWidth=2,t.strokeRect(r,a,o,c),t.fillStyle="#00FFFF";var i=t.measureText((100*e.score).toFixed(2)+"%").width,u=parseInt(n,10);t.fillRect(r,a,i+4,u+4)}),a.forEach(function(e){var n=e.bbox[0],r=e.bbox[1];t.fillStyle="#000000",t.fillText((100*e.score).toFixed(2)+"%",n,r)})},r.state={count:0},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var t=navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:320,height:320}}).then(function(t){return window.stream=t,e.videoRef.current.srcObject=t,new Promise(function(t,n){e.videoRef.current.onloadedmetadata=function(){t()}})}),n=function(){return F.apply(this,arguments)}();Promise.all([n,t]).then(function(t){e.detectFrame(e.videoRef.current,t[0])}).catch(function(e){console.error(e)})}}},{key:"process_input",value:function(e){return p.a.fromPixels(e).toInt().transpose([0,1,2]).expandDims()}},{key:"buildDetectedObjects",value:function(e){var t=document.getElementById("frame"),n=x.a.map(e,function(e){var n=[],r=e.box[0]*t.offsetHeight,a=e.box[1]*t.offsetWidth,o=e.box[2]*t.offsetHeight,c=e.box[3]*t.offsetWidth;return n[0]=a,n[1]=r,n[2]=c-a,n[3]=o-r,{score:e.score,bbox:n}});return console.log(n),n}},{key:"render",value:function(){return h.a.createElement("div",null,h.a.createElement("h1",null,"Terra Cor Diamonds"),h.a.createElement("h3",null,"RealTime Count"),h.a.createElement("h5",null,"Count: ",this.state.count," "),h.a.createElement("div",{style:{position:"relative"}},h.a.createElement("video",{style:{height:"320px",width:"320px"},className:"size",autoPlay:!0,playsInline:!0,muted:!0,ref:this.videoRef,width:"320",height:"320",id:"frame"}),h.a.createElement("canvas",{className:"size",ref:this.canvasRef,width:"320",height:"320"})))}}]),n}(h.a.Component),E=document.getElementById("root");m.a.render(h.a.createElement(j,null),E)},281:function(e,t){},282:function(e,t){},290:function(e,t){},293:function(e,t){},294:function(e,t){},296:function(e,t,n){}},[[269,2,1]]]);
//# sourceMappingURL=main.9b2f9275.chunk.js.map