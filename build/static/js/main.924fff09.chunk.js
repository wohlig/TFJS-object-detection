(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{270:function(e,t,n){e.exports=n(271)},271:function(e,t,n){"use strict";n.r(t);var r=n(5),o=n.n(r),a=n(7),c=n(12),i=n(41),u=n(14),s=n(19),f=n(15),l=n(13),d=n(67),h=n.n(d),v=n(228),m=n.n(v),b=n(226),p=n(225),x=n.n(p),g=n(227),y=n.n(g);n(296);function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var o=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}b.d("webgl");var R=.4;y()();function F(){return(F=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.c("https://raw.githubusercontent.com/wohlig/TFJS-object-detection/master/models/diamond-detector/model.json");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var j=function(e){Object(u.a)(n,e);var t=w(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).videoRef=h.a.createRef(),r.canvasRef=h.a.createRef(),r.detectFrame=function(e,t){b.b().startScope(),y()(),t.executeAsync(r.process_input(e)).then(function(n){var o=n[2].dataSync();o=x.a.map(o,function(e){return e}),o=x.a.chunk(o,4);var a=n[6].dataSync(),c=x.a.map(a,function(e,t){return{score:e,box:o[t]}});c=x.a.filter(c,function(e){return e.score>=R}),console.log(c),r.setState({count:c.length}),r.renderPredictions(c,e),requestAnimationFrame(function(){y()(),Object(i.a)(r).detectFrame(e,t)}),b.b().endScope()})},r.renderPredictions=function(e){var t=r.canvasRef.current.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);var n="16px sans-serif";t.font=n,t.textBaseline="top";var o=r.buildDetectedObjects(e);o.forEach(function(e){var r=e.bbox[0],o=e.bbox[1],a=e.bbox[2],c=e.bbox[3];t.strokeStyle="#00FFFF",t.lineWidth=2,t.strokeRect(r,o,a,c),t.fillStyle="#00FFFF";var i=t.measureText((100*e.score).toFixed(2)+"%").width,u=parseInt(n,10);t.fillRect(r,o,i+4,u+4)}),o.forEach(function(e){var n=e.bbox[0],r=e.bbox[1];t.fillStyle="#000000",t.fillText((100*e.score).toFixed(2)+"%",n,r)})},r.state={count:0},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var t=navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:800,height:600}}).then(function(t){return window.stream=t,e.videoRef.current.srcObject=t,new Promise(function(t,n){e.videoRef.current.onloadedmetadata=function(){t()}})}),n=function(){return F.apply(this,arguments)}();Promise.all([n,t]).then(function(t){e.detectFrame(e.videoRef.current,t[0])}).catch(function(e){console.error(e)})}}},{key:"process_input",value:function(e){return b.a.fromPixels(e).toInt().transpose([0,1,2]).expandDims()}},{key:"buildDetectedObjects",value:function(e){var t=document.getElementById("frame"),n=x.a.map(e,function(e){var n=[],r=e.box[0]*t.offsetHeight,o=e.box[1]*t.offsetWidth,a=e.box[2]*t.offsetHeight,c=e.box[3]*t.offsetWidth;return n[0]=o,n[1]=r,n[2]=c-o,n[3]=a-r,{score:e.score,bbox:n}});return console.log(n),n}},{key:"render",value:function(){return h.a.createElement("div",null,h.a.createElement("h1",null,"Terracor Real-Time Diamond Count"),h.a.createElement("h5",null,"Count: ",this.state.count," "),h.a.createElement("video",{style:{height:"600px",width:"800px"},className:"size",autoPlay:!0,playsInline:!0,muted:!0,ref:this.videoRef,width:"800",height:"600",id:"frame"}),h.a.createElement("canvas",{className:"size",ref:this.canvasRef,width:"800",height:"600"}))}}]),n}(h.a.Component),O=document.getElementById("root");m.a.render(h.a.createElement(j,null),O)},282:function(e,t){},283:function(e,t){},291:function(e,t){},294:function(e,t){},295:function(e,t){},296:function(e,t,n){}},[[270,2,1]]]);
//# sourceMappingURL=main.924fff09.chunk.js.map